plugins {
    id "com.avast.gradle.docker-compose" version "0.14.3"
    id "com.diffplug.spotless" version "5.8.2"
}

apply plugin: 'application'
apply plugin: 'idea'
apply plugin: 'com.avast.gradle.docker-compose'

dockerCompose {
    buildBeforeUp = true
    forceRecreate = true
    startedServices = [
            'loki',
            'traefik',
            'postgres',
            'redis',
            'keycloak',
            'graph',
            'smtp',
            'prometheus',
            'web',
    ]

    def logDir = new File(project.buildDir, "logs")
    if (!logDir.exists()) {
        println("Creating logs folder...")
        logDir.mkdir()
    }
    captureContainersOutput = false
    captureContainersOutputToFile = new File('logs', 'docker-compose-gradle.log')
    projectName = "website"
}

spotless {
    java {
        target '**/*.java'
        googleJavaFormat('1.9').aosp()
        importOrder '', 'javax', 'java', '\\#'
    }

    sql {
        target 'sql/**/*.sql'

        dbeaver()
    }

    groovyGradle {
        target '**/*.gradle'
    }
}

group 'cricket.merstham'

repositories {
    mavenCentral()
    maven { url "https://repo.spring.io/milestone" }
    maven { url "https://repo.spring.io/snapshot" }
}
